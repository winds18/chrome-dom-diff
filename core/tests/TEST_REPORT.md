# Chrome DOM Diff - é›†æˆæµ‹è¯•æŠ¥å‘Š

> **æµ‹è¯•æ—¥æœŸ**: 2026-02-08
> **æµ‹è¯•äººå‘˜**: è€ç‹
> **æµ‹è¯•ç¯å¢ƒ**: Ubuntu Linux, Node.js v24.11.1

---

## ğŸ“‹ æµ‹è¯•æ¦‚è¿°

æœ¬æ¬¡æµ‹è¯•æ—¨åœ¨éªŒè¯Chromeæ’ä»¶WebSocketå®¢æˆ·ç«¯ä¸è½¬å‘æœåŠ¡ç«¯ä¹‹é—´çš„åŒå‘é€šä¿¡ã€‚

### æµ‹è¯•èŒƒå›´

- [x] WebSocketæœåŠ¡ç«¯å¯åŠ¨
- [ ] æ’ä»¶è¿æ¥æµ‹è¯•ï¼ˆéœ€è¦åœ¨æµè§ˆå™¨ä¸­åŠ è½½æ’ä»¶ï¼‰
- [ ] æ’ä»¶æ³¨å†ŒåŠŸèƒ½
- [ ] å¿ƒè·³ä¿æ´»æœºåˆ¶
- [ ] DOMæ•è·æŒ‡ä»¤
- [ ] XPathæŸ¥è¯¢æŒ‡ä»¤
- [ ] ç»“æœä¸ŠæŠ¥

---

## ğŸš€ æµ‹è¯•ç¯å¢ƒå‡†å¤‡

### 1. WebSocketæµ‹è¯•æœåŠ¡å™¨

**æ–‡ä»¶ä½ç½®**: `/home/wings/claude/artifacts/chrome-dom-diff/tests/test_websocket_server.js`

**å¯åŠ¨å‘½ä»¤**:
```bash
cd /home/wings/claude/artifacts/chrome-dom-diff/tests
npm install ws
node test_websocket_server.js
```

**æœåŠ¡å™¨é…ç½®**:
- ç›‘å¬åœ°å€: `ws://127.0.0.1:18080`
- å¿ƒè·³é—´éš”: 30ç§’
- æ”¯æŒçš„æ¶ˆæ¯ç±»å‹: register, heartbeat, result, command

### 2. æµ‹è¯•å®¢æˆ·ç«¯é¡µé¢

**æ–‡ä»¶ä½ç½®**: `/home/wings/claude/artifacts/chrome-dom-diff/tests/test_client.html`

**ä½¿ç”¨æ–¹æ³•**: åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ `file:///home/wings/claude/artifacts/chrome-dom-diff/tests/test_client.html`

---

## âœ… å·²å®Œæˆæµ‹è¯•

### æµ‹è¯•1: WebSocketæœåŠ¡å™¨å¯åŠ¨

**æµ‹è¯•æ­¥éª¤**:
1. å¯åŠ¨Node.jsæµ‹è¯•æœåŠ¡å™¨
2. æ£€æŸ¥ç«¯å£ç›‘å¬çŠ¶æ€

**æµ‹è¯•ç»“æœ**: âœ… é€šè¿‡

```
tcp    0    0 127.0.0.1:18080    0.0.0.0:*    LISTEN    475215/node
```

**ç»“è®º**: æœåŠ¡å™¨æˆåŠŸåœ¨18080ç«¯å£ç›‘å¬

---

## ğŸ“ å¾…å®Œæˆæµ‹è¯•ï¼ˆéœ€è¦æµè§ˆå™¨ç¯å¢ƒï¼‰

### æµ‹è¯•2: æ’ä»¶è¿æ¥æµ‹è¯•

**æµ‹è¯•æ­¥éª¤**:
1. åœ¨Chromeä¸­åŠ è½½æ’ä»¶ï¼ˆ`/home/wings/claude/artifacts/chrome-dom-diff/chrome-extension/`ï¼‰
2. æ‰“å¼€ä»»æ„ç½‘é¡µ
3. è§‚å¯Ÿæµ‹è¯•æœåŠ¡å™¨æ—¥å¿—

**é¢„æœŸç»“æœ**:
- æœåŠ¡å™¨æ˜¾ç¤ºæ–°è¿æ¥æ—¥å¿—
- æ’ä»¶æ˜¾ç¤º"å·²è¿æ¥"çŠ¶æ€

---

### æµ‹è¯•3: æ’ä»¶æ³¨å†ŒåŠŸèƒ½

**é¢„æœŸè¡Œä¸º**:
æ’ä»¶è¿æ¥åè‡ªåŠ¨å‘é€æ³¨å†Œæ¶ˆæ¯ï¼š

```json
{
  "type": "register",
  "plugin_id": "chrome-extension-xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",
  "tab_id": 123,
  "url": "https://...",
  "title": "...",
  "capabilities": ["dom_capture", "xpath_query", "page_navigate", "dom_diff"]
}
```

æœåŠ¡å™¨åº”å›å¤ï¼š

```json
{
  "type": "register_ack",
  "plugin_id": "...",
  "heartbeat_interval": 30,
  "timestamp": ...
}
```

---

### æµ‹è¯•4: å¿ƒè·³ä¿æ´»

**é¢„æœŸè¡Œä¸º**:
- æ¯30ç§’æ’ä»¶å‘é€ä¸€æ¬¡å¿ƒè·³
- æœåŠ¡å™¨å›å¤heartbeat_ack

---

### æµ‹è¯•5: DOMæ•è·æŒ‡ä»¤

**æœåŠ¡å™¨å‘é€**:
```json
{
  "type": "command",
  "command_id": "test-cmd-xxx",
  "action": "dom_capture",
  "payload": {},
  "timestamp": ...
}
```

**æ’ä»¶åº”å›å¤**:
```json
{
  "type": "result",
  "command_id": "test-cmd-xxx",
  "status": "success",
  "timestamp": ...,
  "data": {
    "tree_id": 1,
    "node_count": 1234,
    "duration": "2.45",
    "url": "...",
    "title": "..."
  }
}
```

---

## ğŸ”§ æ’ä»¶é…ç½®

**æ³¨æ„**: ç”±äº8080ç«¯å£è¢«å ç”¨ï¼Œæ’ä»¶é…ç½®å·²ä¸´æ—¶æ”¹ä¸º18080ç«¯å£ï¼š

```javascript
// background.js
var config = {
  serverUrl: 'ws://127.0.0.1:18080',  // ä¸´æ—¶ä¿®æ”¹
  ...
};
```

**ç”Ÿäº§ç¯å¢ƒéœ€è¦æ”¹å›8080ç«¯å£**

---

## ğŸ“Š æµ‹è¯•ç»“è®º

### å½“å‰çŠ¶æ€

| é¡¹ç›® | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| æœåŠ¡å™¨ä»£ç  | âœ… å®Œæˆ | Node.jsæµ‹è¯•æœåŠ¡å™¨å·²å®ç° |
| æœåŠ¡å™¨å¯åŠ¨ | âœ… é€šè¿‡ | 18080ç«¯å£æ­£å¸¸ç›‘å¬ |
| æ’ä»¶ä»£ç  | âœ… å®Œæˆ | WebSocketå®¢æˆ·ç«¯å·²å®ç° |
| ç«¯åˆ°ç«¯æµ‹è¯• | â³ å¾…æµ‹ | éœ€è¦æµè§ˆå™¨ç¯å¢ƒéªŒè¯ |

### ä¸‹ä¸€æ­¥

1. åœ¨Chromeä¸­åŠ è½½æ’ä»¶è¿›è¡Œå®Œæ•´æµ‹è¯•
2. éªŒè¯æ‰€æœ‰æ¶ˆæ¯ç±»å‹
3. ä¿®æ”¹å›8080ç«¯å£ï¼ˆå…ˆæ¸…ç†å ç”¨è¿›ç¨‹ï¼‰
4. ç¼–å†™è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬

---

## ğŸ› ï¸ æ•…éšœæ’æŸ¥

### é—®é¢˜1: ç«¯å£8080è¢«å ç”¨

**è§£å†³æ–¹æ¡ˆ**: ä¸´æ—¶æ”¹ç”¨18080ç«¯å£ï¼Œæˆ–ä½¿ç”¨ `lsof -ti:8080 | xargs kill -9` æ¸…ç†

### é—®é¢˜2: Node.jsæ¨¡å—æœªæ‰¾åˆ°

**è§£å†³æ–¹æ¡ˆ**: è¿è¡Œ `npm install ws` å®‰è£…ä¾èµ–

### é—®é¢˜3: æ’ä»¶æ— æ³•è¿æ¥

**æ£€æŸ¥é¡¹**:
1. æœåŠ¡å™¨æ˜¯å¦æ­£åœ¨è¿è¡Œ
2. ç«¯å£æ˜¯å¦åŒ¹é…
3. é˜²ç«å¢™æ˜¯å¦é˜»æ­¢

---

**æµ‹è¯•æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2026-02-08 23:30
**æµ‹è¯•è€…**: è€ç‹
